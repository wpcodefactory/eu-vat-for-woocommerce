(()=>{"use strict";const e=window.wc.blocksCheckout,a=window.React,t=window.wp.element,o=window.wc.wcSettings,c=window.wp.data,{optInDefaultText:s}=(window.wp.i18n,(0,o.getSetting)("eu-vat-for-woocommerce_data","")),{registerCheckoutBlock:l,extensionCartUpdate:i}=wc.blocksCheckout,{CART_STORE_KEY:n}=window.wc.wcBlocksData,{hasError:r}=!1,v=(e,a)=>{var t="no";d()&&(t="yes");const o=(0,c.select)(n).getCartData(),s=o.billingAddress.country,l=o.billingAddress.company;var r=document.getElementById("alg_wc_eu_vat_progress"),v=document.getElementById("contact-alg_eu_vat-billing_eu_vat_number"),u=document.getElementsByClassName("wc-block-components-checkout-place-order-button")[0];const _=document.getElementById("store_previous_country");u.disabled=!0;var m=new URLSearchParams({action:"alg_wc_eu_vat_validate_action",channel:"bloock_api",alg_wc_eu_vat_to_check:e,billing_country:s,billing_company:l});r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validating,r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-valid"),r.classList.add("alg-wc-eu-vat-validating"),v.classList.remove("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),v.classList.remove("woocommerce-invalid-mismatch"),fetch(alg_wc_eu_vat_ajax_object.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:m}).then((e=>e.json())).then((o=>{"1"==o.status?(v.classList.add("woocommerce-validated"),r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_valid,r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-valid")):"0"==o.status?(v.classList.add("woocommerce-invalid"),r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_not_valid,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid")):"4"==o.status?(v.classList.add("woocommerce-invalid"),r.innerHTML=alg_wc_eu_vat_ajax_object.text_shipping_billing_countries,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid")):"5"==o.status?(v.classList.add("woocommerce-invalid"),v.classList.add("woocommerce-invalid-mismatch"),r.innerHTML=alg_wc_eu_vat_ajax_object.company_name_mismatch,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid")):"6"==o.status?(v.classList.remove("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_failed,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid")):"7"==response?(v.classList.remove("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),"yes"==alg_wc_eu_vat_ajax_object.add_progress_text&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_preserv,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))):"8"==response?(v.classList.remove("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),"yes"==alg_wc_eu_vat_ajax_object.add_progress_text&&(r.innerHTML=alg_wc_eu_vat_ajax_object.vies_not_available,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))):(v.classList.add("woocommerce-invalid"),r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_failed,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid")),_.value=s,a&&i({namespace:"alg-wc-eu-vat-extention-namespace",data:{eu_vat_number:e,eu_country:s,same_billing_shipping:t}}),u.disabled=!1}))},d=()=>{var e=!1,a=document.getElementsByClassName("wc-block-checkout__use-address-for-billing");for(let o=0;o<a.length;o++){var t=a[o].getElementsByTagName("input");for(let a=0;a<t.length;a++)e=t[a].checked}return e},u=JSON.parse('{"apiVersion":2,"name":"eu-vat-for-woocommerce/checkout-eu-vat-field","version":"2.11.8","title":"EU VAT Field","category":"woocommerce","description":"Adds a EU VAT Field checkbox to the checkout.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-contact-information-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}},"text":{"type":"string","source":"html","selector":".wp-block-eu-vat-for-woocommerce-checkout-eu-vat-field","default":""}},"textdomain":"eu-vat-for-woocommerce","editorStyle":"file:../../../build/style-eu-vat-for-woocommerce-checkout-eu-vat-field-block.css"}');(0,e.registerCheckoutBlock)({metadata:u,component:({children:e,checkoutExtensionData:o})=>{const{setExtensionData:s,getExtensionData:l}=o,{setValidationErrors:i,clearValidationError:n}=(0,c.useDispatch)("wc/store/validation"),{CART_STORE_KEY:r}=window.wc.wcBlocksData,u=(0,c.select)(r).getCartData().billingAddress.country;return(0,t.useEffect)((()=>{var e=document.getElementById("contact-alg_eu_vat-billing_eu_vat_number");setTimeout((function(){""!==e.value&&v(e.value,!0)}),500),e.addEventListener("input",(function(e){v(e.target.value,!0)}),!1);var a=function(a){(e=>{var a,t=(a=e,void 0!==alg_wc_eu_frontend_countries_object[a]?alg_wc_eu_frontend_countries_object[a]:"");const o=document.getElementById("store_previous_country");return t!==o&&(o.value=t,!0)})(a.target.value)&&""!==e.value&&v(e.value,!0)},t=function(e){o()},o=function(){var e="billing-country";d()&&(e="shipping-country");var t=document.getElementsByClassName("wc-block-components-country-input");for(let c=0;c<t.length;c++)if(t[c].children[0].getAttribute("id").toString()===e){var o=t[c].getElementsByTagName("input");for(let e=0;e<o.length;e++)o[e].addEventListener("blur",a,!1)}};window.addEventListener("load",(function(e){o();var a=document.getElementsByClassName("wc-block-checkout__use-address-for-billing");for(let e=0;e<a.length;e++){var c=a[e].getElementsByTagName("input");for(let e=0;e<c.length;e++)c[e].addEventListener("change",t,!1)}}))}),[n,i,s]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{id:"alg_eu_vat_for_woocommerce_field",className:"alg-eu-vat-for-woocommerce-fields"},(0,a.createElement)("div",{id:"alg_wc_eu_vat_progress"}),(0,a.createElement)("div",{id:"custom-checkout"}),(0,a.createElement)("input",{type:"hidden",id:"store_previous_country",name:"store_previous_country",value:u})))}})})();