(()=>{"use strict";const e=window.wc.blocksCheckout,t=window.React,a=window.wp.element,c=window.wc.wcSettings,o=window.wp.data,{optInDefaultText:l}=(window.wp.i18n,(0,c.getSetting)("eu-vat-for-woocommerce_data","")),{registerCheckoutBlock:s,extensionCartUpdate:i}=wc.blocksCheckout,{CART_STORE_KEY:n}=window.wc.wcBlocksData,{hasError:r}=!1,d=(e,t)=>{var a="no";v()&&(a="yes");const c=(0,o.select)(n).getCartData(),l=c.billingAddress.country,s=c.billingAddress.company;var r=document.getElementById("alg_wc_eu_vat_progress"),d=document.getElementById("contact-alg_eu_vat-billing_eu_vat_number"),u=document.getElementsByClassName("wc-block-components-checkout-place-order-button")[0];const _=document.getElementById("store_previous_country");u.disabled=!0;var m=new URLSearchParams({action:"alg_wc_eu_vat_validate_action",channel:"bloock_api",alg_wc_eu_vat_to_check:e,billing_country:l,billing_company:s});r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validating,r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-valid"),r.classList.add("alg-wc-eu-vat-validating"));const g=document.getElementById("alg_wc_eu_vat_details");g&&(g.innerHTML=""),d.classList.remove("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),d.classList.remove("woocommerce-invalid-mismatch"),fetch(alg_wc_eu_vat_ajax_object.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:m}).then((e=>e.json())).then((c=>{if(c.vat_details&&g){let e=c.vat_details,t=document.createElement("ul");for(let a in e)if(e.hasOwnProperty(a)){let c=document.createElement("li");c.textContent=`${e[a].label}: ${e[a].data}`,t.appendChild(c)}g?.replaceChildren(t)}"1"==c.status?(d.classList.add("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_valid,r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-valid"))):"0"==c.status?(d.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_not_valid,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):"4"==c.status?(d.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.text_shipping_billing_countries,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):"5"==c.status?(d.classList.add("woocommerce-invalid"),d.classList.add("woocommerce-invalid-mismatch"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.company_name_mismatch,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):"6"==c.status?(d.classList.remove("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_failed,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"))):"7"==c.status?(d.classList.remove("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_preserv,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))):"8"==c.status?(d.classList.remove("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.vies_not_available,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))):(d.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_failed,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))),_.value=l,t&&i({namespace:"alg-wc-eu-vat-extension-namespace",data:{eu_vat_number:e,eu_country:l,same_billing_shipping:a}}),u.disabled=!1}))},v=()=>{var e=!1,t=document.getElementsByClassName("wc-block-checkout__use-address-for-billing");for(let c=0;c<t.length;c++){var a=t[c].getElementsByTagName("input");for(let t=0;t<a.length;t++)e=a[t].checked}return e},u=JSON.parse('{"apiVersion":2,"name":"eu-vat-for-woocommerce/checkout-eu-vat-field","version":"2.11.8","title":"EU VAT Field","category":"woocommerce","description":"Adds a EU VAT Field checkbox to the checkout.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-contact-information-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}},"text":{"type":"string","source":"html","selector":".wp-block-eu-vat-for-woocommerce-checkout-eu-vat-field","default":""}},"textdomain":"eu-vat-for-woocommerce","editorStyle":"file:../../../build/style-eu-vat-for-woocommerce-checkout-eu-vat-field-block.css"}');(0,e.registerCheckoutBlock)({metadata:u,component:({children:e,checkoutExtensionData:c})=>{const{setExtensionData:l,getExtensionData:s}=c,{setValidationErrors:i,clearValidationError:n}=(0,o.useDispatch)("wc/store/validation"),{CART_STORE_KEY:r}=window.wc.wcBlocksData,u=(0,o.select)(r).getCartData().billingAddress.country;return(0,a.useEffect)((()=>{var e=document.getElementById("contact-alg_eu_vat-billing_eu_vat_number");setTimeout((function(){""!==e.value&&d(e.value,!0)}),500),e.addEventListener("input",(function(e){d(e.target.value,!0)}),!1);var t=function(t){(e=>{var t,a=(t=e,void 0!==alg_wc_eu_frontend_countries_object[t]?alg_wc_eu_frontend_countries_object[t]:"");const c=document.getElementById("store_previous_country");return a!==c&&(c.value=a,!0)})(t.target.value)&&""!==e.value&&d(e.value,!0)},a=function(e){c()},c=function(){var e="billing-country";v()&&(e="shipping-country");var a=document.getElementsByClassName("wc-block-components-country-input");for(let o=0;o<a.length;o++)if(a[o].children[0].getAttribute("id")&&a[o].children[0].getAttribute("id").toString()===e){var c=a[o].getElementsByTagName("input");for(let e=0;e<c.length;e++)c[e].addEventListener("blur",t,!1)}};window.addEventListener("load",(function(e){c();var t=document.getElementsByClassName("wc-block-checkout__use-address-for-billing");for(let e=0;e<t.length;e++){var o=t[e].getElementsByTagName("input");for(let e=0;e<o.length;e++)o[e].addEventListener("change",a,!1)}}))}),[n,i,l]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{id:"alg_eu_vat_for_woocommerce_field",className:"alg-eu-vat-for-woocommerce-fields"},"yes"===alg_wc_eu_vat_ajax_object.add_progress_text&&(0,t.createElement)("div",{id:"alg_wc_eu_vat_progress"}),"yes"===alg_wc_eu_vat_ajax_object.show_vat_details&&(0,t.createElement)("div",{id:"alg_wc_eu_vat_details"}),(0,t.createElement)("div",{id:"custom-checkout"}),(0,t.createElement)("input",{type:"hidden",id:"store_previous_country",name:"store_previous_country",value:u})))}})})();