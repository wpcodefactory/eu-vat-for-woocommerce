(()=>{"use strict";const e=window.wc.blocksCheckout,t=window.React,a=window.wp.element,c=window.wc.wcSettings,o=window.wp.data,{optInDefaultText:s}=(window.wp.i18n,(0,c.getSetting)("eu-vat-for-woocommerce_data","")),{registerCheckoutBlock:l,extensionCartUpdate:i}=wc.blocksCheckout,{CART_STORE_KEY:n}=window.wc.wcBlocksData,{hasError:r}=!1,_=(e,t)=>{var a="no";d()&&(a="yes");const c=(0,o.select)(n).getCartData(),s=c.billingAddress.country,l=c.billingAddress.company;var r=document.getElementById("alg_wc_eu_vat_progress"),_=document.getElementById("contact-alg_eu_vat-billing_eu_vat_number"),v=document.getElementsByClassName("wc-block-components-checkout-place-order-button")[0];const u=document.getElementById("store_previous_country");v.disabled=!0;var m=new URLSearchParams({action:"alg_wc_eu_vat_validate_action",channel:"bloock_api",alg_wc_eu_vat_to_check:e,billing_country:s,billing_company:l,shipping_country:c.shippingAddress.country});r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validating,r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-valid"),r.classList.add("alg-wc-eu-vat-validating"));const g=document.getElementById("alg_wc_eu_vat_details");g&&(g.innerHTML=""),_.classList.remove("woocommerce-invalid"),_.classList.remove("woocommerce-validated"),_.classList.remove("woocommerce-invalid-mismatch"),fetch(alg_wc_eu_vat_ajax_object.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:m}).then((e=>e.json())).then((c=>{if(c.vat_details&&g){let e=c.vat_details,t=document.createElement("ul");for(let a in e)if(e.hasOwnProperty(a)){let c=document.createElement("li");c.textContent=`${e[a].label}: ${e[a].data}`,t.appendChild(c)}g?.replaceChildren(t)}alg_wc_eu_vat_ajax_object.status_codes.VAT_VALID===c.status?(_.classList.add("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_valid,r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-valid"))):alg_wc_eu_vat_ajax_object.status_codes.VAT_NOT_VALID===c.status?(_.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_not_valid,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.WRONG_BILLING_COUNTRY===c.status?(_.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_wrong_billing_country,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.KEEP_VAT_SHIPPING_COUNTRY===c.status?(_.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.text_shipping_billing_countries,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.COMPANY_NAME===c.status?(_.classList.add("woocommerce-invalid"),_.classList.add("woocommerce-invalid-mismatch"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.company_name_mismatch,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.EMPTY_VAT===c.status?_.hasAttribute("required")?(_.classList.add("woocommerce-invalid"),_.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_is_required,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"))):(_.classList.remove("woocommerce-invalid"),_.classList.remove("woocommerce-validated"),r&&(r.innerHTML="",r.className="")):alg_wc_eu_vat_ajax_object.status_codes.KEEP_VAT_COUNTRIES===c.status?(_.classList.remove("woocommerce-invalid"),_.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_preserv,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.VIES_UNAVAILABLE===c.status?(_.classList.remove("woocommerce-invalid"),_.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.vies_not_available.replace("%vies_error%",c.error),r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))):(_.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_failed,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))),u.value=s,t&&i({namespace:"alg-wc-eu-vat-extension-namespace",data:{eu_vat_number:e,eu_country:s,same_billing_shipping:a}}),v.disabled=!1}))},d=()=>{var e=!1,t=document.getElementsByClassName("wc-block-checkout__use-address-for-billing");for(let c=0;c<t.length;c++){var a=t[c].getElementsByTagName("input");for(let t=0;t<a.length;t++)e=a[t].checked}return e};if("undefined"!=typeof alg_wc_eu_vat_ajax_object&&alg_wc_eu_vat_ajax_object.do_always_show_zero_vat){const{registerPlugin:e}=wp.plugins,{ExperimentalOrderMeta:a}=wc.blocksCheckout,c=({cart:e,extensions:a})=>{if(0==e.cartTotals.total_tax)return(0,t.createElement)("div",{class:"wc-block-components-totals-item wc-block-components-totals-footer-item"},(0,t.createElement)("span",{class:"wc-block-components-totals-item__label"},"VAT"),(0,t.createElement)("div",{class:"wc-block-components-totals-item__value"},(0,t.createElement)("span",{class:"wc-block-formatted-money-amount wc-block-components-formatted-money-amount wc-block-components-totals-footer-item-tax-value"},"0%")))};e("alg-wc-eu-vat-show-zero-vat",{render:()=>(0,t.createElement)(a,null,(0,t.createElement)(c,null)),scope:"woocommerce-checkout"})}const v=JSON.parse('{"apiVersion":2,"name":"eu-vat-for-woocommerce/checkout-eu-vat-field","version":"2.11.8","title":"EU VAT Field","category":"woocommerce","description":"Adds a EU VAT Field checkbox to the checkout.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-contact-information-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}},"text":{"type":"string","source":"html","selector":".wp-block-eu-vat-for-woocommerce-checkout-eu-vat-field","default":""}},"textdomain":"eu-vat-for-woocommerce","editorStyle":"file:../../../build/style-eu-vat-for-woocommerce-checkout-eu-vat-field-block.css"}');(0,e.registerCheckoutBlock)({metadata:v,component:({children:e,checkoutExtensionData:c})=>{const{setExtensionData:s,getExtensionData:l}=c,{setValidationErrors:i,clearValidationError:n}=(0,o.useDispatch)("wc/store/validation"),{CART_STORE_KEY:r}=window.wc.wcBlocksData,v=(0,o.select)(r).getCartData().billingAddress.country;return(0,a.useEffect)((()=>{var e=document.getElementById("contact-alg_eu_vat-billing_eu_vat_number");setTimeout((function(){""!==e.value&&_(e.value,!0)}),500),e.addEventListener("onblur"===alg_wc_eu_vat_ajax_object.action_trigger?"blur":"input",(function(e){_(e.target.value,!0)}),!1);var t=function(t){(e=>{var t,a=(t=e,void 0!==alg_wc_eu_frontend_countries_object[t]?alg_wc_eu_frontend_countries_object[t]:"");const c=document.getElementById("store_previous_country");return a!==c&&(c.value=a,!0)})(t.target.value)&&""!==e.value&&_(e.value,!0)},a=function(e){c()},c=function(){var e="billing-country";d()&&(e="shipping-country");var a=document.getElementsByClassName("wc-block-components-country-input");for(let o=0;o<a.length;o++)if(a[o].children[0].getAttribute("id")&&a[o].children[0].getAttribute("id").toString()===e){var c=a[o].getElementsByTagName("input");for(let e=0;e<c.length;e++)c[e].addEventListener("blur",t,!1)}};window.addEventListener("load",(function(e){c();var t=document.getElementsByClassName("wc-block-checkout__use-address-for-billing");for(let e=0;e<t.length;e++){var o=t[e].getElementsByTagName("input");for(let e=0;e<o.length;e++)o[e].addEventListener("change",a,!1)}}))}),[n,i,s]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{id:"alg_eu_vat_for_woocommerce_field",className:"alg-eu-vat-for-woocommerce-fields"},"yes"===alg_wc_eu_vat_ajax_object.add_progress_text&&(0,t.createElement)("div",{id:"alg_wc_eu_vat_progress"}),"yes"===alg_wc_eu_vat_ajax_object.show_vat_details&&(0,t.createElement)("div",{id:"alg_wc_eu_vat_details"}),(0,t.createElement)("div",{id:"custom-checkout"}),(0,t.createElement)("input",{type:"hidden",id:"store_previous_country",name:"store_previous_country",value:v})))}})})();