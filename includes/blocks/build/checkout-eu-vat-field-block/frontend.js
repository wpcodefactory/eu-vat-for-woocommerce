(()=>{"use strict";const e=window.wc.blocksCheckout,t=window.wp.plugins,a=window.wp.element,s=window.wp.data,o=window.wc.wcBlocksData,c=window.wc.wcSettings,l=window.lodash,i=window.alg_wc_eu_vat_ajax_object||{},{do_show_hide_by_billing_company:n,is_required:r,optional_text:d}=i,v=(0,c.getSetting)("eu-vat-for-woocommerce_data",{}),{alg_wc_eu_vat_field_id:u,alg_wc_eu_vat_field_position_id:m,get_show_in_countries:_}=v,g="alg_eu_vat_for_woocommerce_field",w={getVatFieldId:()=>u,getVatFieldPositionId:()=>m,getVatDetailsContainerId:()=>g,getVatField:()=>document.querySelector(w.getVatFieldId()),getVatDetailsContainer:()=>document.getElementById(w.getVatDetailsContainerId()),getUseBillingCheckbox:()=>document.querySelector('.wc-block-checkout__use-address-for-billing input[type="checkbox"]'),isUseBillingChecked:()=>{const e=w.getUseBillingCheckbox();return!!e&&e.checked}},p=window.React,L=window.wp.i18n,f=({cart:e})=>"0"===e.cartTotals.total_tax?(0,p.createElement)("div",{className:" wc-block-components-totals-item wc-block-components-totals-footer-item alg-eu-vat-for-woocommerce-zero-vat-wrapper "},(0,p.createElement)("span",{className:"wc-block-components-totals-item__label"},(0,L.__)("VAT","eu-vat-for-woocommerce")),(0,p.createElement)("div",{className:"wc-block-components-totals-item__value"},(0,p.createElement)("span",{className:" wc-block-formatted-money-amount wc-block-components-formatted-money-amount wc-block-components-totals-footer-item-tax-value "},"0%"))):null,y=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"eu-vat-for-woocommerce/checkout-eu-vat-field","version":"4.5.6","title":"EU VAT Field","category":"woocommerce","description":"Adds a EU VAT Field checkbox to the checkout.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-contact-information-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}},"text":{"type":"string","source":"html","selector":".wp-block-eu-vat-for-woocommerce-checkout-eu-vat-field","default":""}},"textdomain":"eu-vat-for-woocommerce","editorScript":"file:./index.js","viewScript":["file:./frontend.js","alg-wc-eu-vat"]}');(0,e.registerCheckoutBlock)({metadata:y,component:({checkoutExtensionData:t,extensions:c})=>{const{setExtensionData:v}=t,u=(0,s.useSelect)((e=>e(o.CART_STORE_KEY).getCartData())),{billingAddress:m,shippingAddress:p}=u,[L,f]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[h,E]=(0,a.useState)(""),k=(0,a.useCallback)((()=>{const t=w.getVatField();if(!t)return;L&&(t.value="");const a=t.value;E(a),((t,a)=>{let c="no";w.isUseBillingChecked()&&(c="yes");const l=(0,s.select)(o.CART_STORE_KEY).getCartData(),n=l.billingAddress.country,r=l.billingAddress.company;var d=document.getElementById("alg_wc_eu_vat_progress"),v=document.getElementById("contact-alg_eu_vat-billing_eu_vat_number"),u=document.getElementsByClassName("wc-block-components-checkout-place-order-button")[0];const m=document.getElementById("store_previous_country");u.disabled=!0;var _=new URLSearchParams({action:"alg_wc_eu_vat_validate_action",channel:"bloock_api",alg_wc_eu_vat_to_check:t,billing_country:n,billing_company:r,shipping_country:l.shippingAddress.country});d&&(d.innerHTML=i.progress_text_validating,d.classList.remove("alg-wc-eu-vat-not-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.remove("alg-wc-eu-vat-valid"),d.classList.add("alg-wc-eu-vat-validating"));const g=document.getElementById("alg_wc_eu_vat_details");g&&(g.innerHTML=""),v.classList.remove("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),v.classList.remove("woocommerce-invalid-mismatch"),fetch(i.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:_}).then((e=>e.json())).then((a=>{if(a.vat_details&&g){let e=a.vat_details,t=document.createElement("ul");for(let a in e)if(e.hasOwnProperty(a)){let s=document.createElement("li");s.textContent=`${e[a].label}: ${e[a].data}`,t.appendChild(s)}g?.replaceChildren(t)}i.status_codes.VAT_VALID===a.status?(v.classList.add("woocommerce-validated"),d&&(d.innerHTML=i.progress_text_valid,d.classList.remove("alg-wc-eu-vat-not-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.add("alg-wc-eu-vat-valid"))):i.status_codes.VAT_NOT_VALID===a.status?(v.classList.add("woocommerce-invalid"),d&&(d.innerHTML=i.progress_text_not_valid,d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.add("alg-wc-eu-vat-not-valid"))):i.status_codes.WRONG_BILLING_COUNTRY===a.status?(v.classList.add("woocommerce-invalid"),d&&(d.innerHTML=i.progress_text_wrong_billing_country,d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.add("alg-wc-eu-vat-not-valid"))):i.status_codes.KEEP_VAT_SHIPPING_COUNTRY===a.status?(v.classList.add("woocommerce-invalid"),d&&(d.innerHTML=i.text_shipping_billing_countries,d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.add("alg-wc-eu-vat-not-valid"))):i.status_codes.KEEP_VAT_BASE_COUNTRY_SHIPPING===a.status?(v.classList.add("woocommerce-invalid"),d&&(d.innerHTML=i.text_base_country_shipping_countries,d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.add("alg-wc-eu-vat-not-valid"))):i.status_codes.COMPANY_NAME===a.status?(v.classList.add("woocommerce-invalid"),v.classList.add("woocommerce-invalid-mismatch"),d&&(d.innerHTML=i.company_name_mismatch,d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.add("alg-wc-eu-vat-not-valid"))):i.status_codes.EMPTY_VAT===a.status?v.hasAttribute("required")?(v.classList.add("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),d&&(d.innerHTML=i.progress_text_is_required,d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.remove("alg-wc-eu-vat-not-valid"))):(v.classList.remove("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),d&&(d.innerHTML="",d.className="")):i.status_codes.KEEP_VAT_COUNTRIES===a.status?(v.classList.remove("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),d&&(d.innerHTML=i.progress_text_validation_preserv,d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.remove("alg-wc-eu-vat-not-valid"),d.classList.add("alg-wc-eu-vat-not-valid"))):i.status_codes.VIES_UNAVAILABLE===a.status?(v.classList.remove("woocommerce-invalid"),v.classList.remove("woocommerce-validated"),d&&(d.innerHTML=i.vies_not_available.replace("%vies_error%",a.error),d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.remove("alg-wc-eu-vat-not-valid"),d.classList.add("alg-wc-eu-vat-not-valid"))):(v.classList.add("woocommerce-invalid"),d&&(d.innerHTML=i.progress_text_validation_failed,d.classList.remove("alg-wc-eu-vat-valid"),d.classList.remove("alg-wc-eu-vat-validating"),d.classList.remove("alg-wc-eu-vat-not-valid"),d.classList.add("alg-wc-eu-vat-not-valid"))),m.value=n,(0,e.extensionCartUpdate)({namespace:"alg-wc-eu-vat-extension-namespace",data:{eu_vat_number:t,eu_country:n,same_billing_shipping:c,billing_company:r}}),u.disabled=!1}))})(a)}),[L]),x=(0,a.useRef)((0,l.debounce)((e=>{e()}),500)).current;(0,a.useEffect)((()=>()=>{x.cancel()}),[x]);const T=(0,a.useCallback)((()=>{x(k)}),[x,k]);return(0,a.useEffect)((()=>{v("eu-vat-for-woocommerce-block-example","billing_eu_vat_number",h)}),[v,h]),(0,a.useEffect)((()=>{var e;const t=w.getVatField();if(!t)return;(e=>{if("yes"===e.dataset.algVatMoved)return;const t=w.getVatFieldPositionId()?document.querySelector(w.getVatFieldPositionId())?.closest("div"):null;let a=null;t&&(a=t),a&&(a.insertAdjacentElement("afterend",e.closest("div")),e.dataset.algVatMoved="yes")})(t),((e,t)=>{if(w.getVatDetailsContainer())return;const a=document.createElement("div");a.id=g,a.className="alg-eu-vat-for-woocommerce-fields",a.innerHTML=`\n\t\t${"yes"===i.add_progress_text?'<div id="alg_wc_eu_vat_progress"></div>':""}\n\t\t${"yes"===i.show_vat_details?'<div id="alg_wc_eu_vat_details"></div>':""}\n\t\t<div id="custom-checkout"></div>\n\t\t<input \n\t\t\ttype="hidden"\n\t\t\tid="store_previous_country"\n\t\t\tname="store_previous_country"\n\t\t\tvalue="${t}"\n\t\t/>\n\t`,e.closest("div").insertAdjacentElement("afterend",a)})(t,m.country);const a="onblur"===(null!==(e=i.action_trigger)&&void 0!==e?e:"onblur")?"blur":"input";t.addEventListener(a,T);const s=w.getUseBillingCheckbox();return s&&s.addEventListener("input",T),()=>{t.removeEventListener(a,T),s&&T&&s.removeEventListener("input",T)}}),[m.country,T]),(0,a.useEffect)((()=>{T()}),[m.country,m.company,p.country,p.company,T]),(0,a.useEffect)((()=>{const e=w.getVatField(),t=w.getVatDetailsContainer();if(e){const t=e.closest("div");t&&(t.style.display=L?"none":"")}t&&(t.style.display=L?"none":"")}),[L,y]),(0,a.useEffect)((()=>{const e=_?_.split(","):[],t=!!e.length&&!e.includes(m.country),a=!!n&&""===m.company;if(f(t||a),"yes_for_company"===r){const e=document.getElementById("alg_wc_eu_vat_progress"),t=w.getVatField();if(!t)return;const a=t.closest("div")?.querySelector("label");if(!a)return;""!==m.company?(a.textContent=a.textContent.replace(d,""),b(!0)):(a.textContent.includes(d)||(a.textContent+=d),e&&""===t.value&&(e.textContent=""),b(!1))}}),[m.country,m.company]),null}}),(0,t.registerPlugin)("alg-wc-eu-vat-show-zero-vat",{render:()=>"undefined"!=typeof alg_wc_eu_vat_ajax_object&&alg_wc_eu_vat_ajax_object.do_always_show_zero_vat?(0,p.createElement)(e.ExperimentalOrderMeta,null,(0,p.createElement)(f,null)):null,scope:"woocommerce-checkout"})})();