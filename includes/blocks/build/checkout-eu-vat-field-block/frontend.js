(()=>{"use strict";const e=window.wc.blocksCheckout,t=window.wp.plugins,a=window.wp.element,c=window.wp.data,o=window.wc.wcBlocksData,s=window.wc.wcSettings,{alg_wc_eu_vat_field_id:l,alg_wc_eu_vat_field_position_id:i}=(0,s.getSetting)("eu-vat-for-woocommerce_data",{}),n='.wc-block-checkout__use-address-for-billing input[type="checkbox"]',_=(t,a)=>{var s="no";(()=>{const e=document.querySelector(n);return!!e&&e.checked})()&&(s="yes");const l=(0,c.select)(o.CART_STORE_KEY).getCartData(),i=l.billingAddress.country,_=l.billingAddress.company;var r=document.getElementById("alg_wc_eu_vat_progress"),d=document.getElementById("contact-alg_eu_vat-billing_eu_vat_number"),v=document.getElementsByClassName("wc-block-components-checkout-place-order-button")[0];const u=document.getElementById("store_previous_country");v.disabled=!0;var m=new URLSearchParams({action:"alg_wc_eu_vat_validate_action",channel:"bloock_api",alg_wc_eu_vat_to_check:t,billing_country:i,billing_company:_,shipping_country:l.shippingAddress.country});r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validating,r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-valid"),r.classList.add("alg-wc-eu-vat-validating"));const w=document.getElementById("alg_wc_eu_vat_details");w&&(w.innerHTML=""),d.classList.remove("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),d.classList.remove("woocommerce-invalid-mismatch"),fetch(alg_wc_eu_vat_ajax_object.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:m}).then((e=>e.json())).then((c=>{if(c.vat_details&&w){let e=c.vat_details,t=document.createElement("ul");for(let a in e)if(e.hasOwnProperty(a)){let c=document.createElement("li");c.textContent=`${e[a].label}: ${e[a].data}`,t.appendChild(c)}w?.replaceChildren(t)}alg_wc_eu_vat_ajax_object.status_codes.VAT_VALID===c.status?(d.classList.add("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_valid,r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-valid"))):alg_wc_eu_vat_ajax_object.status_codes.VAT_NOT_VALID===c.status?(d.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_not_valid,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.WRONG_BILLING_COUNTRY===c.status?(d.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_wrong_billing_country,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.KEEP_VAT_SHIPPING_COUNTRY===c.status?(d.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.text_shipping_billing_countries,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.COMPANY_NAME===c.status?(d.classList.add("woocommerce-invalid"),d.classList.add("woocommerce-invalid-mismatch"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.company_name_mismatch,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.EMPTY_VAT===c.status?d.hasAttribute("required")?(d.classList.add("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_is_required,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"))):(d.classList.remove("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),r&&(r.innerHTML="",r.className="")):alg_wc_eu_vat_ajax_object.status_codes.KEEP_VAT_COUNTRIES===c.status?(d.classList.remove("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_preserv,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))):alg_wc_eu_vat_ajax_object.status_codes.VIES_UNAVAILABLE===c.status?(d.classList.remove("woocommerce-invalid"),d.classList.remove("woocommerce-validated"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.vies_not_available.replace("%vies_error%",c.error),r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))):(d.classList.add("woocommerce-invalid"),r&&(r.innerHTML=alg_wc_eu_vat_ajax_object.progress_text_validation_failed,r.classList.remove("alg-wc-eu-vat-valid"),r.classList.remove("alg-wc-eu-vat-validating"),r.classList.remove("alg-wc-eu-vat-not-valid"),r.classList.add("alg-wc-eu-vat-not-valid"))),u.value=i,a&&(0,e.extensionCartUpdate)({namespace:"alg-wc-eu-vat-extension-namespace",data:{eu_vat_number:t,eu_country:i,same_billing_shipping:s}}),v.disabled=!1}))},r=window.React,d=window.wp.i18n,v=({cart:e})=>"0"===e.cartTotals.total_tax?(0,r.createElement)("div",{className:" wc-block-components-totals-item wc-block-components-totals-footer-item alg-eu-vat-for-woocommerce-zero-vat-wrapper "},(0,r.createElement)("span",{className:"wc-block-components-totals-item__label"},(0,d.__)("VAT","eu-vat-for-woocommerce")),(0,r.createElement)("div",{className:"wc-block-components-totals-item__value"},(0,r.createElement)("span",{className:" wc-block-formatted-money-amount wc-block-components-formatted-money-amount wc-block-components-totals-footer-item-tax-value "},"0%"))):null,u=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"eu-vat-for-woocommerce/checkout-eu-vat-field","version":"4.5.6","title":"EU VAT Field","category":"woocommerce","description":"Adds a EU VAT Field checkbox to the checkout.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-contact-information-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}},"text":{"type":"string","source":"html","selector":".wp-block-eu-vat-for-woocommerce-checkout-eu-vat-field","default":""}},"textdomain":"eu-vat-for-woocommerce","editorScript":"file:./index.js","viewScript":["file:./frontend.js","alg-wc-eu-vat"]}');(0,e.registerCheckoutBlock)({metadata:u,component:()=>{const e=(0,c.select)(o.CART_STORE_KEY).getCartData(),t=e.billingAddress.country,s=e.shippingAddress.country;return(0,a.useEffect)((()=>{const e=document.querySelector(l);if(!e)return;(e=>{if("yes"===e.dataset.algVatMoved)return;if(!i)return null;const t=document.querySelector(i)?.closest("div");let a=null;a=t||document.querySelector(l)?.closest("div")||null,a&&(a.insertAdjacentElement("afterend",e.closest("div")),e.dataset.algVatMoved="yes")})(e),((e,t)=>{const a="alg_eu_vat_for_woocommerce_field";if(document.getElementById(a))return;const c=document.createElement("div");c.id=a,c.className="alg-eu-vat-for-woocommerce-fields",c.innerHTML=`\n\t\t${"yes"===alg_wc_eu_vat_ajax_object.add_progress_text?'<div id="alg_wc_eu_vat_progress"></div>':""}\n\t\t${"yes"===alg_wc_eu_vat_ajax_object.show_vat_details?'<div id="alg_wc_eu_vat_details"></div>':""}\n\t\t<div id="custom-checkout"></div>\n\t\t<input type="hidden"\n\t\t\tid="store_previous_country"\n\t\t\tname="store_previous_country"\n\t\t\tvalue="${t}"\n\t\t/>\n\t`,e.closest("div").insertAdjacentElement("afterend",c)})(e,t),setTimeout((function(){""!==e.value&&_(e.value,!0)}),500);const a=function(){_(e.value,!0)},c="onblur"===alg_wc_eu_vat_ajax_object.action_trigger?"blur":"input";e.addEventListener(c,a);const o=document.querySelector(n);return o&&o.addEventListener("input",a),()=>{e.removeEventListener(c,a)}}),[t,s]),null}}),(0,t.registerPlugin)("alg-wc-eu-vat-show-zero-vat",{render:()=>"undefined"!=typeof alg_wc_eu_vat_ajax_object&&alg_wc_eu_vat_ajax_object.do_always_show_zero_vat?(0,r.createElement)(e.ExperimentalOrderMeta,null,(0,r.createElement)(v,null)):null,scope:"woocommerce-checkout"})})();